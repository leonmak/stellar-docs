---
title: Install WebAssembly (Wasm) bytecode using code
---

<head>
  <title>Install WebAssembly (Wasm) bytecode using code</title>
  <meta charSet="utf-8" />
  <meta
    property="og:title"
    content="Install WebAssembly (Wasm) bytecode using code"
  />
  <meta
    property="og:description"
    content="This guide will walk you through installing the wasm of the contract using js-stellar-sdk."
  />
</head>

This guide will walk you through installing the wasm of the contract using [js-stellar-sdk](https://github.com/stellar/js-stellar-sdk).

Note that this process just uploads the contract code to the testnet as a transaction. You still have to [deploy the contract](./deploy-contract.mdx) to interact with it, view `stellar contract deploy -h`.

# Prerequisites

Before you begin, ensure you have the following installed:

1. [Rust](https://www.rust-lang.org/) and Cargo (for compiling smart contracts)
2. [Node.js](https://nodejs.org/en) and npm (for running JavaScript deployment scripts)
3. [Soroban CLI](../../smart-contracts/getting-started/setup.mdx#install-the-stellar-cli)

# Initialize and build a sample Rust Contract

```bash
soroban contract init hello-world
cd hello-world

# use rust compiler to compile Rust project into a WebAssembly (Wasm) dynamic library (cdylib).
soroban contract build
# cargo rustc --manifest-path=contracts/hello_world/Cargo.toml --crate-type=cdylib --target=wasm32-unknown-unknown --release
```

We are initializing the default `hello_world` contract in [soroban_examples](https://github.com/stellar/soroban-examples) to the directory `hello-world`. You may use the `-w` option to create with another example like `account`.

After building the contract for release, the generated .wasm file is at the path `hello-word/target/wasm32-unknown-unknown/release/hello_world.wasm`

# Install Wasm bytecode with Node Project

1. Create a new directory for your Node.js project and navigate into it:

```bash
mkdir install-wasm
cd install-wasm
```

2. Initialize a new Node.js project with a javascript file, and install necessary dependencies:

```bash
touch index.js
npm init es6 -y
npm install @stellar/stellar-sdk fs
```

## Imports

Import necessary modules in your JavaScript file:

```javascript
import * as StellarSDK from "@stellar/stellar-sdk";
import fs from "fs";
```

## Installing the WASM on the network

Create a function to upload the compiled WASM file:

```javascript
async function uploadWasm(filePath) {
  const bytecode = fs.readFileSync(filePath);
  const account = await server.getAccount(sourceKeypair.publicKey());
  const operation = StellarSDK.Operation.uploadContractWasm({ wasm: bytecode });
  return await buildAndSendTransaction(account, operation);
}
```

This function reads the compiled Wasm file, retrieves account details from the network, and installs the bytecode using `uploadContractWasm` Stellar operation, which when wrapped in a transaction is sent to the network.

## Building, Signing and Sending the Transaction

Handle the building, signing, and sending of transactions:

```javascript
async function buildAndSendTransaction(account, operations) {
  const transaction = new StellarSDK.TransactionBuilder(account, {
    fee: StellarSDK.BASE_FEE,
    networkPassphrase: StellarSDK.Networks.TESTNET,
  })
    .addOperation(operations)
    .setTimeout(30)
    .build();

  const tx = await server.prepareTransaction(transaction);
  tx.sign(sourceKeypair);

  console.log("Submitting transaction...");
  let response = await server.sendTransaction(tx);
  const hash = response.hash;
  console.log(`Transaction hash: ${hash}`);
  console.log("Awaiting confirmation...");

  while (true) {
    response = await server.getTransaction(hash);
    if (response.status !== "NOT_FOUND") {
      break;
    }
    await new Promise((resolve) => setTimeout(resolve, 1000));
  }

  if (response.status === "SUCCESS") {
    console.log("Transaction successful.");
    return response;
  } else {
    console.log("Transaction failed.");
    throw new Error("Transaction failed");
  }
}
```

This function constructs a transaction, signs it, and submits it to the network, handling any necessary retries for transaction confirmation.

# Running the Script

Execute the deployment script:

```javascript
const server = new StellarSDK.SorobanRpc.Server(
  "https://soroban-testnet.stellar.org:443",
);
const sourceKeypair = StellarSDK.Keypair.fromSecret("Your_Secret_Key");
const wasmFilePath =
  "../target/wasm32-unknown-unknown/release/hello_world.wasm"; // Adjust this path as necessary

try {
  let uploadResponse = await uploadWasm(wasmFilePath);
  await deployContract(uploadResponse);
} catch (error) {
  console.error(error);
}
```

Replace "Your_Secret_Key" with your actual secret key. This script initiates the upload of the WASM file and deploys the contract, resulting in a contract address where the contract is deployed.

This is just demo code, so ensure that you handle secrets and private keys securely in production environments and never expose them in your code repositories. This guide should provide you with a clear path to installing and deploying your smart contracts using Javascript code.

```bash
stellar keys generate --global hello --network testnet
stellar keys show hello
```

The Stellar CLI can be used to generate identities, e.g. `hello`, and show its secret key.

# Complete Script

Here are all the snippets stacked together in a single file for convenience:

```javascript
import * as StellarSDK from "@stellar/stellar-sdk";
import fs from "fs";

async function uploadWasm(filePath) {
  const bytecode = fs.readFileSync(filePath);
  const account = await server.getAccount(sourceKeypair.publicKey());
  const operation = StellarSDK.Operation.uploadContractWasm({ wasm: bytecode });
  return await buildAndSendTransaction(account, operation);
}

async function buildAndSendTransaction(account, operations) {
  const transaction = new StellarSDK.TransactionBuilder(account, {
    fee: StellarSDK.BASE_FEE,
    networkPassphrase: StellarSDK.Networks.TESTNET,
  })
    .addOperation(operations)
    .setTimeout(30)
    .build();

  const tx = await server.prepareTransaction(transaction);
  tx.sign(sourceKeypair);

  console.log("Submitting transaction...");
  let response = await server.sendTransaction(tx);
  const hash = response.hash;
  console.log(`Transaction hash: ${hash}`);
  console.log("Awaiting confirmation...");

  while (true) {
    response = await server.getTransaction(hash);
    if (response.status !== "NOT_FOUND") {
      break;
    }
    await new Promise((resolve) => setTimeout(resolve, 1000));
  }

  if (response.status === "SUCCESS") {
    console.log("Transaction successful.");
    return response;
  } else {
    console.log("Transaction failed.");
    throw new Error("Transaction failed");
  }
}

const server = new StellarSDK.SorobanRpc.Server(
  "https://soroban-testnet.stellar.org:443",
);
const sourceKeypair = StellarSDK.Keypair.fromSecret("Your_Secret_Key");
const wasmFilePath =
  "../target/wasm32-unknown-unknown/release/hello_world.wasm"; // Adjust this path as necessary

try {
  let uploadResponse = await uploadWasm(wasmFilePath);
  const byteArray = uploadResponse.returnValue.bytes();
  const wasmHash = byteArray.toString("hex");
  console.log(`Wasm hash: ${wasmHash}`);
} catch (error) {
  console.error(error);
}
```

Run the script with `node index.js` and see the following console output:

```bash
Submitting transaction...
Transaction hash: cef7a63667fe5b0ddcde5562d90e0a40bc04c69616916d1d7fa74a8571bbd82f
Awaiting confirmation...
Transaction successful.
Wasm hash: 275405755441e4be59555bb5c5fd81e84ed21659015d8f3594796c1cf3f380db
```

The returned contract transaction hash can be viewed with online tools:

e.g. [https://stellar.expert/explorer/testnet/tx/cef7a63667fe5b0ddcde5562d90e0a40bc04c69616916d1d7fa74a8571bbd82f]()

You may use the Wasm hash for deployment with Stellar CLI:

```bash
stellar contract deploy \
    --source hello \
    --network testnet \
    --wasm-hash 275405755441e4be59555bb5c5fd81e84ed21659015d8f3594796c1cf3f380db
# CC6NAQE3ZHRQV3NPQB3F3NYEFBAMEABA4KQTM6A2V5V7PBR5H3UEU3MW
```

View the deployed contract using the returned identifier with online tools:

e.g. [https://stellar.expert/explorer/testnet/contract/CC6NAQE3ZHRQV3NPQB3F3NYEFBAMEABA4KQTM6A2V5V7PBR5H3UEU3MW]()
